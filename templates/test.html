<!doctype html>
<html>
    <head>
        <title>TEST</title>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='test.css') }}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
          let data;

          function loadAllEvents(allEvents){
            var tableObject = $('table');
            $.each(allEvents, function(i, item){
              var str = '<tr id="'+item.event_id+'">"';
              var btn = '<button id="btn_'+item.event_id+'">Details</button>';
              var tr = $(str).append(
                $('<td class="event_id">').text(item.event_id),
                $('<td class="created_by">').text(item.created_by + "'s "),
                $('<td class="sport">').text(item.sport + " event "),
                $('<td class="people_participating" hidden>').text("People participating: " + item.people_participating),
                $('<td class="people_needed"        hidden>').text("People needed: " + item.people_needed),
                $('<td class="date"                 hidden>').text("Date: " + item.date),
                $('<td class="time"                 hidden>').text("Time: " + item.time),
                $('<td class="loacation"            hidden>').text("Location: " + item.location),
                $('<td class="price"                hidden>').text("Price: " + item.price),
                $('<td class="description"          hidden>').text("Description: " + item.description),
                $('<td class="button">').append(btn)
              );
              $("table").append(tr);

              $("#btn_"+item.event_id).click(function(){
                console.log('Button ' + item.event_id + ' clicked');
                $("#"+item.event_id+" > .people_participating").toggle();
                $("#"+item.event_id+" > .people_needed").toggle();
                $("#"+item.event_id+" > .date").toggle();
                $("#"+item.event_id+" > .time").toggle();
                $("#"+item.event_id+" > .location").toggle();
                $("#"+item.event_id+" > .price").toggle();
                $("#"+item.event_id+" > .description").toggle();
              })
            })
          }


          function getData(){
            let deferred = $.Deferred();
            $.ajax({
              url: "http://localhost:5000/rest/events",
              dataType: "json",
              type: "GET",
              success: function(result){
                data = result;
                deferred.resolve();
              }
            });
            return deferred.promise();
          }


          $(document).ready(function(){
            $.when(getData()).done(function(){
              loadAllEvents(data);
            });
          });
        </script>
    </head>
    <body>
      <h1> Sports Eventer </h1>

      <table>

      </table>
    </body>
</html>
